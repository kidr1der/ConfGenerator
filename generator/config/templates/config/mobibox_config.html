{% extends 'config/create_config.html' %}

{% block content %}
<h1>{{ title }}</h1>
<br>
/ip dns set allow-remote-requests=no <br>
/ip service disable ftp,telnet <br>
/ip service disable api,api-ssl <br>
/system clock set time-zone-name=Europe/Moscow <br>
/system ntp client set enabled=yes primary-ntp=213.170.71.126 secondary-ntp=198.60.73.8 <br>
/system watchdog set watchdog-timer=yes no-ping-delay=180 watch-address={{ cuMikrotikIP }} <br>
/system watchdog set watchdog-timer=yes ping-timeout=180 watch-address={{ cuMikrotikIP }} <br>
/system identity set name={{ mnemokod }} <br>
<br>
ip firewall address-list add list=manage address=172.16.0.0/12 <br>
ip firewall address-list add list=manage address=192.168.0.0/16 <br>
ip firewall address-list add list=manage address=213.170.105.102 <br>
ip firewall address-list add list=manage address=213.170.120.49 <br>
ip firewall address-list add list=manage address=213.170.116.37 <br>
ip firewall address-list add list=manage address=213.170.117.4 <br>
ip firewall address-list add list=manage address=88.86.77.65 <br>
ip firewall address-list add list=manage address=77.235.202.4 <br>
ip firewall filter add chain=input action=accept src-address-list=manage <br>
ip firewall filter add chain=input action=reject reject-with=icmp-network-unreachable protocol=tcp dst-port=22,23,80,8291 <br>
<br>
/interface eoip add name=eoip remote-address={{ eoip }} tunnel-id={{ tunnel_id }} !keepalive <br>
/interface vlan add interface=eoip name=vlan{{ vlan }} vlan-id={{ vlan }} <br>
<br>
/interface bridge remove [find] <br>
/interface bridge port remove [find] <br>
/interface bridge add name=bridge <br>
/interface bridge port add bridge=bridge interface=ether1 <br>
/interface bridge port add bridge=bridge interface=vlan{{ vlan }} <br>
<br>
/interface ethernet reset-mac-address 0 <br>
/interface ethernet reset-mac-address 1 <br>
<br>
/interface l2tp-client set max-mtu=1300 max-mru=1300 numbers=0 <br>
<br>
:global user [/interface l2tp-client get number=0 value-name=user] <br>
:global pass [/interface l2tp-client get number=0 value-name=password] <br>
:global l2tpIP [/interface l2tp-client get number=0 value-name=connect-to] <br>
:global maxmtu [/interface l2tp-client get number=0 value-name=max-mtu] <br>
:global maxmru [/interface l2tp-client get number=0 value-name=max-mru] <br>
<br>
/tool netwatch add host=$l2tpIP down-script="log error \"Core mikrotik DOWN, trying reset USB power... See netwatch.\"\ <br>
    \n/system routerboard usb power-reset duration=10s\ <br>
    \n:delay 25\ <br>
    \n/ip dhcp-client add default-route-distance=10 interface=lte1 disabled=no\ <br>
    \n/ip dhcp-client set interface=lte1 numbers=0\ <br>
    \n/ip dhcp-client set default-route-distance=10 numbers=0" up-script=":global stausL2TP [/interface l2tp-client get number=0 running]\ <br>
    \nif (\$stausL2TP = false) do={\ <br>
    \n  log error \"Core mikrotik UP, but l2tp not running, trying reconfigure l2tp...See netwatch.\"\ <br>
    \n  /interface l2tp-client remove [/interface l2tp-client find]\ <br>
    \n  /interface l2tp-client add name=l2tp-out1 add-default-route=yes connect-to=$l2tpIP default-route-distance=1 disabled=no \ <br>
    password=\"$pass\" profile=default user=$user max-mtu=$maxmtu max-mru=$maxmru keepalive-timeout=disabled\ <br>
    \n}" <br>
<br>
<br>
<input type=button class="btn btn-primary" value="Previous Page" onClick="javascript:history.go(-1);">
{% endblock  %}